import{_ as E}from"./preload-helper.CLcXU_4U.js";import{o as N,a as R,s as h,d as $,b as I,m as M,i as V,k as O}from"./config.DlMdeYpO.js";import"https://cdn.jsdelivr.net/npm/dompurify@2.3.4/dist/purify.min.js";import"https://cdn.jsdelivr.net/npm/marked/marked.min.js";import"./hoisted.D3FFN0QM.js";let C,D;const q=async()=>{try{C=(await E(async()=>{const{default:e}=await import("https://cdn.skypack.dev/dompurify");return{default:e}},[])).default,D=(await E(async()=>{const{default:e}=await import("https://cdn.skypack.dev/marked");return{default:e}},[])).default}catch(e){console.error("Error cargando librerías:",e)}},z=document.getElementById("loading"),F=document.getElementById("editor-container");document.getElementById("article-form");const a=document.getElementById("title"),o=document.getElementById("slug"),d=document.getElementById("description"),r=document.getElementById("author"),G=document.getElementById("draft"),k=document.getElementById("featured"),S=document.getElementById("comments-enabled"),u=document.getElementById("save-status");document.getElementById("word-count");document.getElementById("char-count");const m=document.getElementById("desc-count"),w=document.getElementById("last-saved"),B=document.getElementById("save-time"),H=document.getElementById("save-draft-btn"),U=document.getElementById("preview-btn"),j=document.getElementById("publish-btn");document.getElementById("success-message");const b=document.getElementById("error-message"),_=document.getElementById("error-details");document.getElementById("view-article-link");document.getElementById("sync-content-btn");const f=document.getElementById("preview-modal"),J=document.getElementById("close-preview"),L=document.getElementById("preview-content");let v=null,c=!1,l=null,T="",P="",K=[];const Q=e=>e.toLowerCase().replace(/[^\w\sáéíóúüñ]/g,"").replace(/\s+/g,"-").replace(/á/g,"a").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú|ü/g,"u").replace(/ñ/g,"n").replace(/-+/g,"-").trim(),x=()=>{if(m&&d){const e=d.value.length;m.textContent=e.toString(),m.className=e>140?"text-yellow-400":e>160?"text-red-400":"text-gray-400"}},i=(e,t="gray")=>{if(u){const n=u.querySelector("div"),s=u.querySelector("span");n&&(n.className=`w-2 h-2 rounded-full mr-2 bg-${t}-400`),s&&(s.textContent=e,s.className=`text-${t}-400`)}},W=()=>{if(w&&B){const e=new Date;B.textContent=e.toLocaleTimeString(),w.classList.remove("hidden")}},p=async(e=!0)=>{if(c){e&&i("Guardando...","yellow");try{const t={title:a.value||"",slug:o.value||"",author:r.value||"",description:d.value||"",content:T||"",image:P||"",tags:K||[],draft:!0,featured:k.checked,commentsEnabled:S.checked,updatedAt:h()};if(v){const n=$(I,"drafts",v);await M(n,t,{merge:!0})}else{const n=V(I,"drafts");v=(await O(n,{...t,createdAt:h()})).id}e&&(i("Guardado","green"),W()),c=!1}catch(t){console.error("Error al guardar borrador:",t),e&&i("Error al guardar","red")}}},g=()=>{l&&clearTimeout(l),i("Cambios sin guardar","yellow"),l=setTimeout(()=>p(),3e3)},X=async()=>{await new Promise(e=>setTimeout(e,1e3)),Y(),z.classList.add("hidden"),F.classList.remove("hidden")},Y=()=>{a.addEventListener("input",()=>{(!o.value||a.dataset.lastValue===o.value)&&(o.value=Q(a.value)),a.dataset.lastValue=o.value,c=!0,g()}),[a,o,d,r].forEach(e=>{e.addEventListener("input",()=>{c=!0,g(),x()})}),[G,k,S].forEach(e=>{e.addEventListener("change",()=>{c=!0,g()})}),H?.addEventListener("click",()=>p(!0)),U?.addEventListener("click",Z),j?.addEventListener("click",ee),J?.addEventListener("click",()=>{f?.classList.add("hidden")}),x()},Z=()=>{if(!(!L||!f))try{const e=a.value||"Sin título",t=r.value||"Sin autor",n=d.value||"Sin descripción",s=T||"*No hay contenido*",A=C.sanitize(D.parse(s));let y=`
        <div class="mb-6">
          <h1 class="text-3xl font-bold text-white mb-2">${e}</h1>
          <p class="text-gray-300 mb-4">Por ${t}</p>
          <p class="text-gray-400 italic">${n}</p>
        </div>
      `;y+=`<div class="prose prose-invert prose-green max-w-none">${A}</div>`,L.innerHTML=y,f.classList.remove("hidden")}catch(e){console.error("Error al generar vista previa:",e),alert("Error al generar la vista previa.")}},ee=async e=>{e.preventDefault(),!a.value||!o.value||!r.value||d.value,b&&_&&(_.textContent="Por favor, completa todos los campos obligatorios.",b.classList.remove("hidden"))};N(R,async e=>{e&&(await q(),e.displayName&&r&&!r.value&&(r.value=e.displayName),await X())});window.addEventListener("beforeunload",()=>{l&&clearTimeout(l),c&&p(!1)});
