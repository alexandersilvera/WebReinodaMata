import{j as e}from"./jsx-runtime.BjG_zV1W.js";import{r as a}from"./index.BcVDQ18_.js";import{i as H,b as L,n as P,h as y,f as S}from"./config.DlMdeYpO.js";async function A(){try{const s=H(L,"subscribers"),u=await P(s);let n=0,c=0,r=0,x=0;return u.docs.forEach(i=>{const h=i.data();h.deleted===!0?x++:(n++,h.active===!0?c++:r++)}),{total:n,active:c,inactive:r,deleted:x}}catch(s){return console.error("Error al obtener estadísticas de suscriptores:",s),{total:0,active:0,inactive:0,deleted:0}}}function q(s){return s.code==="failed-precondition"?"Se requiere crear un índice en Firestore. Consulta la consola para más detalles.":s.code==="permission-denied"?"No tienes permisos para realizar esta operación.":s.code==="unavailable"?"El servicio de Firestore no está disponible temporalmente.":s.code==="deadline-exceeded"?"La consulta tardó demasiado tiempo. Intenta de nuevo.":`Error de Firestore: ${s.message||"Error desconocido"}`}async function D(s,u=3,n=1e3){let c;for(let r=0;r<=u;r++)try{return await s()}catch(x){if(c=x,r===u)break;const i=n*Math.pow(2,r);await new Promise(h=>setTimeout(h,i))}throw c}function R(){const[s,u]=a.useState(""),[n,c]=a.useState(""),[r,x]=a.useState(""),[i,h]=a.useState("Centro Umbandista Reino Da Mata"),[b,E]=a.useState(""),[f,v]=a.useState(!1),[d,m]=a.useState(null),[g,C]=a.useState(!1),[o,k]=a.useState({total:0,active:0,inactive:0,deleted:0}),[j,w]=a.useState(!1),[F,N]=a.useState(!0);a.useEffect(()=>{(async()=>{N(!0);try{const l=await D(()=>A(),3,1e3);k(l)}catch(l){console.error("Error al cargar estadísticas de suscriptores:",l);const p=q(l);m({success:!1,message:`Error al cargar estadísticas: ${p}`})}finally{N(!1)}})()},[]);const T=async()=>{if(!b||!s||!n){m({success:!1,message:"Por favor completa al menos el asunto, contenido y correo de prueba"});return}w(!0);try{const l=await y(S,"sendTestNewsletter")({subject:s,content:n,htmlContent:r,fromName:i,testEmail:b});m(l.data)}catch(t){console.error("Error al enviar correo de prueba:",t),m({success:!1,message:"Error al enviar el correo de prueba"})}finally{w(!1)}},M=()=>{C(!g)},z=async t=>{if(t.preventDefault(),!s||!n){m({success:!1,message:"Por favor completa al menos el asunto y contenido"});return}if(window.confirm(`¿Estás seguro de enviar este newsletter a ${o.active} suscriptores activos?`)){v(!0);try{const p=await y(S,"sendNewsletterToSubscribers")({subject:s,content:n,htmlContent:r,fromName:i});m(p.data),p.data.success}catch(l){console.error("Error al enviar newsletter:",l),m({success:!1,message:"Error al enviar el newsletter"})}finally{v(!1)}}};return e.jsxs("div",{className:"bg-green-900/30 p-6 rounded-lg backdrop-blur-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-500",children:"Enviar Newsletter"}),F?e.jsxs("div",{className:"flex items-center text-sm text-green-300 bg-green-900/50 px-3 py-1 rounded-md",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cargando estadísticas..."]}):e.jsx("div",{className:"text-sm text-green-300 bg-green-900/50 px-3 py-1 rounded-md",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-green-400",children:o.active})," activos"]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:o.total})," totales"]}),o.inactive>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-yellow-400",children:o.inactive})," inactivos"]})]}),o.deleted>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-red-400",children:o.deleted})," eliminados"]})]})]})})]}),d&&e.jsxs("div",{className:`p-4 mb-6 rounded-md ${d.success?"bg-green-600/80":"bg-red-600/80"} text-white`,children:[e.jsx("p",{className:"font-medium",children:d.success?"¡Envío exitoso!":"Error"}),e.jsx("p",{children:d.message}),d.success&&d.sent&&e.jsxs("p",{className:"text-sm mt-1",children:["Correos enviados: ",d.sent]})]}),e.jsx("div",{className:"mb-6 flex space-x-2",children:e.jsx("button",{type:"button",onClick:M,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-md transition-colors",children:g?"Ocultar vista previa":"Mostrar vista previa"})}),g&&e.jsx("div",{className:"mb-6 border border-green-600 rounded-md overflow-hidden",children:e.jsxs("div",{className:"bg-gray-100 p-4 text-gray-800",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"De:"})," ",i]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Asunto:"})," ",s||"[Sin asunto]"]}),e.jsx("hr",{className:"my-2 border-gray-300"}),e.jsx("div",{className:"mt-4",children:r?e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}):e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:n||"[Sin contenido]"})})]})}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fromName",className:"block text-white text-sm font-medium mb-2",children:"Nombre del remitente"}),e.jsx("input",{id:"fromName",type:"text",value:i,onChange:t=>h(t.target.value),className:"w-full px-4 py-2 bg-green-700/50 border border-green-600 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",className:"block text-white text-sm font-medium mb-2",children:"Asunto"}),e.jsx("input",{id:"subject",type:"text",value:s,onChange:t=>u(t.target.value),className:"w-full px-4 py-2 bg-green-700/50 border border-green-600 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-white text-sm font-medium mb-2",children:"Contenido (texto plano)"}),e.jsx("textarea",{id:"content",value:n,onChange:t=>c(t.target.value),rows:6,className:"w-full px-4 py-2 bg-green-700/50 border border-green-600 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"htmlContent",className:"block text-white text-sm font-medium mb-2",children:"Contenido HTML (opcional)"}),e.jsx("textarea",{id:"htmlContent",value:r,onChange:t=>x(t.target.value),rows:10,className:"w-full px-4 py-2 bg-green-700/50 border border-green-600 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400 text-white font-mono text-sm"})]}),e.jsxs("div",{className:"bg-blue-900/30 p-4 rounded-md border border-blue-800",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-400 mb-3",children:"Enviar correo de prueba"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"email",value:b,onChange:t=>E(t.target.value),placeholder:"correo@ejemplo.com",className:"flex-grow px-4 py-2 bg-blue-800/50 border border-blue-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-white"}),e.jsx("button",{type:"button",onClick:T,disabled:j||!b,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-md transition-colors disabled:bg-blue-800 disabled:cursor-not-allowed flex items-center",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Enviando..."})]}):e.jsx("span",{children:"Enviar prueba"})})]}),e.jsx("p",{className:"text-xs text-blue-300 mt-2",children:"Envía una copia del newsletter a tu correo para verificar cómo se verá."})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 px-6 bg-green-600 hover:bg-green-500 text-white font-medium rounded-md shadow-md transition-colors duration-300 flex items-center justify-center disabled:bg-green-800 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsxs("span",{children:["Enviando a ",o.active," suscriptores..."]})]}):e.jsxs("span",{children:["Enviar Newsletter a ",o.active," suscriptores"]})})]})]})}export{R as default};
