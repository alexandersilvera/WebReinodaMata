import{j as e}from"./jsx-runtime.BjG_zV1W.js";import{r as s}from"./index.BcVDQ18_.js";import{a as k,d as g,b as o,g as z,q,e as A,w as T,i as y,j as M,k as V,s as B,u as F,l as H}from"./config.DlMdeYpO.js";function O({postId:u,postTitle:G}){const[p,w]=s.useState([]),[l,f]=s.useState(""),[r,C]=s.useState(null),[i,x]=s.useState(null),[S,E]=s.useState(!0),[b,j]=s.useState(!1),[N,h]=s.useState(null),[d,c]=s.useState("");s.useEffect(()=>{const t=k.onAuthStateChanged(async a=>{if(C(a),a)try{const n=g(o,"userProfiles",a.uid),m=await z(n);m.exists()?x(m.data()):(console.log("No existe perfil del usuario, usando datos de auth"),x({displayName:a.displayName||"Usuario",photoURL:a.photoURL||"/images/default-avatar.png"}))}catch(n){console.error("Error al cargar perfil de usuario:",n),x({displayName:a.displayName||"Usuario",photoURL:a.photoURL||"/images/default-avatar.png"})}E(!1)});return()=>t()},[]),s.useEffect(()=>{const t=q(y(o,"comments"),T("postId","==",u),A("createdAt","desc")),a=M(t,n=>{const m=n.docs.map(v=>({id:v.id,...v.data()}));w(m)});return()=>a()},[u]);const R=async t=>{if(t.preventDefault(),!(!r||!l.trim()||!i)){j(!0);try{await V(y(o,"comments"),{text:l.trim(),userId:r.uid,userDisplayName:i.displayName||"Usuario",userPhotoURL:i.photoURL||"/images/default-avatar.png",createdAt:B(),postId:u,edited:!1}),f("")}catch(a){console.error("Error al publicar comentario:",a),alert("No se pudo publicar tu comentario. Inténtalo de nuevo.")}finally{j(!1)}}},D=t=>{h(t.id),c(t.text)},L=()=>{h(null),c("")},U=async t=>{if(!(!r||!d.trim()))try{const a=g(o,"comments",t);await F(a,{text:d.trim(),edited:!0}),h(null),c("")}catch(a){console.error("Error al editar comentario:",a),alert("No se pudo editar tu comentario. Inténtalo de nuevo.")}},I=async t=>{if(r&&window.confirm("¿Estás seguro de que quieres eliminar este comentario?"))try{await H(g(o,"comments",t))}catch(a){console.error("Error al eliminar comentario:",a),alert("No se pudo eliminar el comentario. Inténtalo de nuevo.")}},P=t=>{if(!t)return"";const a=t.toDate();return new Intl.DateTimeFormat("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)};return S?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-green-500 rounded-full border-t-transparent"})}):e.jsxs("div",{className:"mt-12 pt-8 border-t border-green-900/30",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-400 mb-6",children:"Comentarios"}),r&&i?e.jsx("form",{onSubmit:R,className:"mb-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:i.photoURL||"/images/default-avatar.png",alt:i.displayName||"Usuario",className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-white font-medium",children:i.displayName||"Usuario"})}),e.jsx("textarea",{value:l,onChange:t=>f(t.target.value),placeholder:"Escribe un comentario...",className:"w-full p-3 bg-green-900/20 border border-green-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white min-h-[100px] resize-y",required:!0}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{type:"submit",disabled:b||!l.trim(),className:"px-4 py-2 bg-green-700 hover:bg-green-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"}),"Publicando..."]}):"Publicar comentario"})})]})]})}):e.jsxs("div",{className:"bg-green-900/30 rounded-lg p-6 mb-8 text-center",children:[e.jsx("p",{className:"text-white mb-4",children:"Para dejar un comentario debes iniciar sesión primero."}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("a",{href:"/login",className:"px-4 py-2 bg-green-700 hover:bg-green-600 text-white rounded-md transition-colors",children:"Iniciar sesión"}),e.jsx("a",{href:"/register",className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-colors",children:"Registrarse"})]})]}),e.jsx("div",{className:"space-y-6",children:p.length===0?e.jsx("p",{className:"text-center text-gray-400 py-8",children:"Sé el primero en comentar este artículo."}):p.map(t=>e.jsxs("div",{className:"bg-green-900/20 rounded-lg p-5 border border-green-900/30",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.userPhotoURL||"/images/default-avatar.png",alt:t.userDisplayName,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white",children:t.userDisplayName}),e.jsxs("p",{className:"text-xs text-gray-400",children:[P(t.createdAt),t.edited&&e.jsx("span",{className:"ml-2 text-green-400",children:"(editado)"})]})]})]}),r&&r.uid===t.userId&&e.jsx("div",{className:"flex gap-2",children:N!==t.id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(t),className:"text-gray-400 hover:text-green-500 transition-colors",title:"Editar comentario",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),e.jsx("button",{onClick:()=>I(t.id),className:"text-gray-400 hover:text-red-500 transition-colors",title:"Eliminar comentario",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]}),N===t.id?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:d,onChange:a=>c(a.target.value),className:"w-full p-3 bg-green-900/30 border border-green-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-white min-h-[80px] resize-y",required:!0}),e.jsxs("div",{className:"flex justify-end mt-2 gap-2",children:[e.jsx("button",{onClick:L,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-colors text-sm",children:"Cancelar"}),e.jsx("button",{onClick:()=>U(t.id),disabled:!d.trim(),className:"px-3 py-1.5 bg-green-700 hover:bg-green-600 text-white rounded-md transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Guardar cambios"})]})]}):e.jsx("p",{className:"text-gray-300 whitespace-pre-line break-words",children:t.text})]},t.id))})]})}export{O as default};
